{% comment %}
  Landing Palette Overrides (scoped per template instance)
  - Adds a unique class to <html> so CSS only applies to this landing.
  - Forces Dawn-like variables + CTA vars using !important.
{% endcomment %}

{%- assign cls = 'palette-' | append: section.id | handleize -%}

<script>
  (function () {
    var cls = '{{ cls }}';
    console.log('ðŸŽ¨ Visual Injection: Applying class', cls);
    try { 
      document.documentElement.classList.add(cls); 
      document.body.classList.add(cls);
    } catch (e) {
      console.error('Visual Injection Error:', e);
    }
  })();
</script>

<style>
  /* Ensure our new wrappers are block-level and handle backgrounds properly */
  .image-with-text__outer, .multicolumn__outer {
    width: 100%;
    display: block;
  }
  
  /* ========== Scoped palette variables (on <html> or <body>) ========== */
  html.{{ cls }}, body.{{ cls }} {
    /* Optimization: Use 'color_to_rgb' to handle both Hex Strings and Color Objects */
    --landing-accent-1: {{ section.settings.accent_1 | color_to_rgb | remove: 'rgb(' | remove: ')' }};
    --landing-accent-2: {{ section.settings.accent_2 | color_to_rgb | remove: 'rgb(' | remove: ')' }};
    --landing-text:     {{ section.settings.text | color_to_rgb | remove: 'rgb(' | remove: ')' }};
    --landing-bg-1:     {{ section.settings.background_1 | color_to_rgb | remove: 'rgb(' | remove: ')' }};
    --landing-bg-2:     {{ section.settings.background_2 | color_to_rgb | remove: 'rgb(' | remove: ')' }};
    
    --landing-cta-bg:   {{ section.settings.button_background | color_to_rgb | remove: 'rgb(' | remove: ')' }};
    --landing-cta-text: {{ section.settings.button_label | color_to_rgb | remove: 'rgb(' | remove: ')' }};
    --landing-cta-hover:{{ section.settings.button_hover | color_to_rgb | remove: 'rgb(' | remove: ')' }};
    
    /* Variables Base de Dawn (compatibilidad) */
    --color-base-accent-1: var(--landing-accent-1) !important;
    --color-base-accent-2: var(--landing-accent-2) !important;
    --color-base-text: var(--landing-text) !important;
    --color-base-background-1: var(--landing-bg-1) !important;
    --color-base-background-2: var(--landing-bg-2) !important;
    --color-base-solid-button-labels: var(--landing-cta-text) !important;
    --color-base-solid-button: var(--landing-cta-bg) !important;
  }

  /* Override schemes specific to this landing */
  html.{{ cls }} .color-background-1, body.{{ cls }} .color-background-1,
  html.{{ cls }} .color-scheme-background-1, body.{{ cls }} .color-scheme-background-1 {
    --color-background: var(--landing-bg-1) !important;
    --gradient-background: rgb(var(--landing-bg-1)) !important;
    --color-foreground: var(--landing-text) !important;
    color: rgb(var(--landing-text));
  }
  
  html.{{ cls }} .color-background-2, body.{{ cls }} .color-background-2,
  html.{{ cls }} .color-scheme-background-2, body.{{ cls }} .color-scheme-background-2 {
    --color-background: var(--landing-bg-2) !important;
    --gradient-background: rgb(var(--landing-bg-2)) !important;
    --color-foreground: var(--landing-text) !important;
    color: rgb(var(--landing-text));
  }
  
  html.{{ cls }} .color-accent-1, body.{{ cls }} .color-accent-1,
  html.{{ cls }} .color-scheme-accent-1, body.{{ cls }} .color-scheme-accent-1 {
    --color-background: var(--landing-accent-1) !important;
    --gradient-background: rgb(var(--landing-accent-1)) !important;
    --color-foreground: var(--landing-bg-1) !important;
    color: rgb(var(--landing-bg-1));
  }
  
  /* CTA Buttons override */
  html.{{ cls }} .button--primary, body.{{ cls }} .button--primary,
  html.{{ cls }} .shopify-payment-button__button--unbranded,
  html.{{ cls }} .shopify-payment-button__button--branded {
     background-color: rgb(var(--landing-cta-bg)) !important;
     color: rgb(var(--landing-cta-text)) !important;
     border-color: rgb(var(--landing-cta-bg)) !important;
  }
  
  html.{{ cls }} .button--primary:hover, 
  html.{{ cls }} .shopify-payment-button__button--unbranded:hover {
     background-color: rgb(var(--landing-cta-hover)) !important;
     border-color: rgb(var(--landing-cta-hover)) !important;
  }

  /* Fix gradients if needed */
  html.{{ cls }} .gradient {
    background-attachment: initial !important; 
  }
</style>

{% schema %}
{
  "name": "Landing palette overrides",
  "tag": "section",
  "class": "section",
  "settings": [
    { "type": "color", "id": "accent_1", "label": "Accent 1", "default": "#ff4081" },
    { "type": "color", "id": "accent_2", "label": "Accent 2", "default": "#ffebee" },
    { "type": "color", "id": "text", "label": "Text", "default": "#212121" },
    { "type": "color", "id": "background_1", "label": "Background 1", "default": "#ffffff" },
    { "type": "color", "id": "background_2", "label": "Background 2", "default": "#f8f8f8" },

    { "type": "color", "id": "button_label", "label": "CTA Text", "default": "#ffffff" },
    { "type": "color", "id": "button_background", "label": "CTA Background", "default": "#ff4081" },
    { "type": "color", "id": "button_hover", "label": "CTA Hover", "default": "#e6396f" }
  ],
  "presets": [
    { "name": "Landing palette overrides" }
  ]
}
{% endschema %}
